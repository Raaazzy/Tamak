@model HomeViewModel

@if (User.Identity.IsAuthenticated) {
<div class="container">
    <header class="d-flex flex-wrap justify-content-center py-3">
        <a href="/" class="d-flex align-items-center mb-3 mb-md-0 me-md-auto link-body-emphasis text-decoration-none">
            <span class="fs-2 text-primary" style="font-weight:700">Tamak</span>
        </a>

        <ul class="nav nav-pills">
                <li class="nav-item"><a href="/User/GetUser" class="nav-link text-dark">Профиль</a></li>
                <li class="nav-item">
                    @if (User.IsInRole("User"))
                    {
                        <a href="#" class="nav-link text-dark">Корзина</a>
                    } else
                    {
                        <a href="#" class="nav-link text-dark">Список заказов</a>
                    }
                </li>
                <li class="nav-item">
                <form method="post" asp-controller="Account" asp-action="Logout">
                    <input class="nav-link text-dark" type="submit" value="Выйти"/>
                </form>
            </li>
        </ul>
    </header>
</div>


<div style="background-color: #f2f2f2" class="album py-5">
    <div class="container">
        <div class="row row-cols-1 row-cols-sm-2 row-cols-md-3 g-3">
                @{
                    if (User.IsInRole("Admin"))
                    {
                        if (Model.allProducts == null)
                        {
                            <div class="col-lg-3 d-flex align-items-center">
                                <h3>Упс, а еда тут еще не появилась...</h3>
                            </div>
                        }
                        foreach (Product product in Model.allProducts)
                        {
                            @Html.Partial("AllProducts", product)
                        }

                    }
                    else
                    {
                        bool flag = false;
                        foreach (User user in Model.allUsers)
                        {
                            if (user.Role.ToString() == "Admin")
                            {
                                flag = true;

                                <div class="border col-12">
                                    <h3>Название: @user.Name.ToString()</h3>
                                    <p>Город: @user.City.ToString()</p>
                                </div>
                            }
                        }
                        if (!flag)
                        {
                            <div class="col-lg-3 d-flex align-items-center">
                                <h3>Упс, а еда тут еще не появилась....</h3>
                            </div>
                        }
                    }
                }
        </div>
            @if (User.IsInRole("Admin"))
            {
                <form asp-controller="Home" asp-action="Add">
                    <button class="w-100 btn btn-primary" type="submit">Добавить продукт</button>
                </form>
            }
        </div>
</div>


}
else
{
    @Html.Partial("Login", Model.loginViewModel)
}

@section pageScripts {
    <script>
        function ckick(str) {
            const data = $(str).serialize();
            $.ajax({
                url: '@Url.Action("Save")',
                type: 'POST',
                data: data,

            });
        }

        $('#changeAvaliable').on('click', function () {
            const data = $('#productAvaliable').serialize();
            $.ajax({
                url: '@Url.Action("ChangeAvaliable")',
                type: 'POST',
                data: data,

            });

            $(this).text(function (i, text) {
                return text === "Нет в наличии" ? "Есть в наличии" : "Нет в наличии";
            });

            $(".formColor").css('opacity', $(".formColor").css('opacity') === '1' ? '0.6' : '1');

            $("#backCard").css('opacity', $("#backCard").css('opacity') === '1' ? '0.5' : '1');

        });
    </script>
}